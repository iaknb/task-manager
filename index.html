<!DOCTYPE html>
<html>

<head>
  <title>Aplikacja do zarządzania zadaniami</title>
  <link rel="stylesheet" href="style.css">
</head>

<body>
  <h1>Lista zadań</h1>
  <div id="task-list"></div>

  <h2>Wszyscy użytkownicy</h2>
  <ul id="user-list"></ul>

  <h2>Dodaj użytkownika</h2>
  <form id="add-user-form" action="/users" method="POST">
    <input type="text" name="name" placeholder="Imię" required>
    <input type="text" name="last_name" placeholder="Nazwisko" required>
    <button type="submit">Dodaj użytkownika</button>
  </form>

  <h2>Dodaj projekt</h2>
  <form id="add-project-form" action="/projects" method="POST">
    <input type="text" name="name" placeholder="Nazwa projektu" required>
    <button type="submit">Dodaj projekt</button>
  </form>

  <h2>Dodaj zadanie</h2>
  <form id="add-task-form" action="/tasks" method="POST">
    <input type="text" name="name" placeholder="Nazwa zadania" required>
    <input type="number" name="project_id" placeholder="ID projektu" required>
    <input type="number" name="user_id" placeholder="ID użytkownika" required>
    <button type="submit">Dodaj zadanie</button>
  </form>

  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script>
    $(document).ready(function () {
      // Pobranie listy projektów
      $(document).ready(function () {
        // Pobranie listy zadań i projektów po załadowaniu strony
        $.get("/projects", function (projects) {
          projects.forEach(function (project) {
            let projectItem = $("<li><strong>Projekt:</strong> " + project.name + " (ID: " + project.id + ")</li>");
            let tasksList = $("<ul></ul>");

            $.get("/tasks/" + project.id, function (tasks) {
              if (tasks.length > 0) {
                tasks.forEach(function (task) {
                  tasksList.append("<li>" + task.name + " (Użytkownik: " + task.user_name + ")</li>");
                });
              } else {
                tasksList.append("<li>Brak zadań</li>");
              }

              projectItem.append(tasksList);
              $("#task-list").append(projectItem);
            });
          });
        });
        $.get("/users", function (users) {
          users.forEach(function (user) {
            let userItem = $("<li>" + user.name + " " + user.last_name + "</li>");
            $("#user-list").append(userItem);
          });
        });
      })
      $(document).ready(function () {
        $.get("/showusers", function (showusers) {
          let userhead = $("<h1>Użytkownicy wprowadzeni do bazy:</h1>")
          let userlist = $("<ul></ul>")
          showusers.forEach(function (showuser) {
              userlist.append("<li>" + showuser.name + ", id:"+ showuser.id + "</li>")
          })
          $("#user-list").append(userlist)
          
        })
      })



      // Obsługa dodawania użytkownika
      $('#add-user-form').submit(function (event) {
        event.preventDefault();
        const form = $(this);
        const url = form.attr('action');
        const formData = form.serialize();
        $.post(url, formData, function (response) {
          alert('Dodano użytkownika!');
          form.trigger('reset');
          location.reload()
        });
      });

      // Obsługa dodawania projektu
      $('#add-project-form').submit(function (event) {
        event.preventDefault();
        const form = $(this);
        const url = form.attr('action');
        const formData = form.serialize();
        $.post(url, formData, function (response) {
          alert('Dodano projekt!');
          form.trigger('reset');
          location.reload(); // Przeładuj stronę po dodaniu projektu
        });
      });

      // Obsługa dodawania zadania
      $('#add-task-form').submit(function (event) {
        event.preventDefault();
        const form = $(this);
        const url = form.attr('action');
        const formData = form.serialize();
        $.post(url, formData, function (response) {
          alert('Dodano zadanie!');
          form.trigger('reset');
          location.reload();
        });
      });
    });
  </script>
</body>

</html>